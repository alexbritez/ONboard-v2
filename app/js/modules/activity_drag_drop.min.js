window.ONboard.modules.activity_drag_drop={initialize:function(c){window.ONboard.activeModule=this;this.data=c;$("div#activity").empty().removeAttr("class");
var b=ONboard.assetRoot+$(c).find("audio").text()+".mp4";if(_.isUndefined(ONboard.video)){ONboard.video=_V_("video",{controls:true,autoplay:true,preload:"auto"},function(){this.src({type:"video/mp4",src:b}).play();
});ONboard.video.addEvent("ended",function(){ONboard.activeModule.mediaEnded();});}else{ONboard.video.src({type:"video/mp4",src:b}).play();}if($("div#video").hasClass("video")){$("div#video").removeClass("video").addClass("audio");
}else{$("div#video").addClass("audio");}$("div#video div.vjs-control").show();var a=$(c).find("matching");this.hasPoints=a.attr("hasPoints");this.points=parseFloat(a.attr("points"));
this.deductionFactor=parseFloat(a.attr("deductionFactor"));this.maxAttempts=parseFloat(a.attr("maxAttempts"));this.currentAttempt=0;this.answers=new Array();
this.dropped=new Array();this.content={matchingInstructions:$(c).find("matchingInstructions").text(),instructions:$(c).find("instructions").text(),matches:new Array(),drops:new Array()};
$(c).find("matches").each(function(){ONboard.modules.activity_drag_drop.content.matches={title:$(this).attr("title"),choices:$(this).children(),};});$(c).find("drops").each(function(){ONboard.modules.activity_drag_drop.content.drops={title:$(this).attr("title"),choices:$(this).children(),};
});$("div#footer div#copyright div#credits").html($(c).find("credits").text().trim());this.content.alphabet=new Array("A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","1","2","3","4","5","6","7","8","9","0","(",")","~","!","@","#","$","%","^","&","*","-","=","+","_",".",",","`","{","}","[","]","|","'","\\",'"',"/","?",":",";",">","<"," ","\n");
this.UI(c);},UI:function(f){var k=$("div#activity");var h=this.content;var b=this;var c=parseInt($(f).find("matching").attr("skipLetter"));if(!c>0){c=0;
}var l='<div id="matchingContainer" class="gradient"><div id="matching"></div><div id="controls">';if(this.hasPoints=="true"){l+='<p id="instructions">'+h.instructions+'</p><a id="submit" class="button" href="javascript:void(0);">Check Answers</a>';
}l+="</div></div>";if($(f).find("matching").attr("type")=="dynamic"&&$(f).find("matching").attr("format")=="inside-small"){k.attr("class","activity_drag_drop dynamic inside-small").html(l);
}else{if($(f).find("matching").attr("type")=="dynamic"&&$(f).find("matching").attr("format")=="letter"){k.attr("class","activity_drag_drop dynamic letter").html(l);
}else{if($(f).find("matching").attr("type")=="dynamic"&&$(f).find("matching").attr("format")=="letter-small"){k.attr("class","activity_drag_drop dynamic letter small").html(l);
}else{if($(f).find("matching").attr("format")=="letter-small"){k.attr("class","activity_drag_drop letter-small").html(l);}else{if($(f).find("matching").attr("type")=="dynamic"&&$(f).find("matching").attr("format")=="number"){k.attr("class","activity_drag_drop dynamic number").html(l);
}else{if($(f).find("matching").attr("type")=="dynamic"&&$(f).find("matching").attr("format")=="number-small"){k.attr("class","activity_drag_drop dynamic number small").html(l);
}else{if($(f).find("matching").attr("format")=="number-small"){k.attr("class","activity_drag_drop number-small").html(l);}else{if($(f).find("matching").attr("type")=="small"){k.attr("class","activity_drag_drop small").html(l);
}else{k.attr("class","activity_drag_drop dynamic").html(l);}}}}}}}}if($(f).find("matching").attr("type")=="dynamic"&&$(f).find("matching").attr("format")=="inside-small"){for(var e=0;
e<$(h.matches).size();e++){var m='<div id="matching-'+e+'" class="matching-column"><p id="matchingInstructions">'+h.matchingInstructions+"</p>";for(var d=0;
d<$(h.matches.choices).size();d++){if(Boolean($(h.matches.choices[d]).attr("id"))==true){m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+$(h.matches.choices[d]).text()+"</span></div></div>";
}else{m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+$(h.matches.choices[d]).text()+"</span></div></div>";
}}m+="</div>";}}else{if($(f).find("matching").attr("type")=="dynamic"&&$(f).find("matching").attr("format")=="letter"){for(var e=0;e<$(h.matches).size();
e++){var m='<div id="matching-'+e+'" class="matching-column"><p id="matchingInstructions">'+h.matchingInstructions+"</p>";for(var d=0;d<$(h.matches.choices).size();
d++){if(Boolean($(h.matches.choices[d]).attr("id"))==true){m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+h.alphabet[d+c]+'</span></div><div class="matching-text">'+$(h.matches.choices[d]).text()+"</div></div>";
}else{m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+h.alphabet[d+c]+'</span></div><div class="matching-text">'+$(h.matches.choices[d]).text()+"</div></div>";
}}m+="</div>";}}else{if($(f).find("matching").attr("type")=="dynamic"&&$(f).find("matching").attr("format")=="letter-small"){for(var e=0;e<$(h.matches).size();
e++){var m='<div id="matching-'+e+'" class="matching-column"><p id="matchingInstructions">'+h.matchingInstructions+"</p>";for(var d=0;d<$(h.matches.choices).size();
d++){if(Boolean($(h.matches.choices[d]).attr("id"))==true){m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+h.alphabet[d+c]+"</span></div>"+$(h.matches.choices[d]).text()+"</div>";
}else{m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+h.alphabet[d+c]+"</span></div>"+$(h.matches.choices[d]).text()+"</div>";
}}m+="</div>";}}else{if($(f).find("matching").attr("format")=="letter-small"){for(var e=0;e<$(h.matches).size();e++){var m='<div id="matching-'+e+'" class="matching-column"><p id="matchingInstructions">'+h.matchingInstructions+"</p>";
for(var d=0;d<$(h.matches.choices).size();d++){if(Boolean($(h.matches.choices[d]).attr("id"))==true){m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+h.alphabet[d+c]+"</span></div>"+$(h.matches.choices[d]).text()+"</div>";
}else{m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+h.alphabet[d+c]+"</span></div>"+$(h.matches.choices[d]).text()+"</div>";
}}m+="</div>";}}else{if($(f).find("matching").attr("type")=="dynamic"&&$(f).find("matching").attr("format")=="number"){for(var e=0;e<$(h.matches).size();
e++){var m='<div id="matching-'+e+'" class="matching-column"><p id="matchingInstructions">'+h.matchingInstructions+"</p>";for(var d=0;d<$(h.matches.choices).size();
d++){if(Boolean($(h.matches.choices[d]).attr("id"))==true){m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+(d+1)+"</span></div>"+$(h.matches.choices[d]).text()+"</div>";
}else{m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+(d+1)+"</span></div>"+$(h.matches.choices[d]).text()+"</div>";
}}m+="</div>";}}else{if($(f).find("matching").attr("type")=="dynamic"&&$(f).find("matching").attr("format")=="number-small"){for(var e=0;e<$(h.matches).size();
e++){var m='<div id="matching-'+e+'" class="matching-column"><p id="matchingInstructions">'+h.matchingInstructions+"</p>";for(var d=0;d<$(h.matches.choices).size();
d++){if(Boolean($(h.matches.choices[d]).attr("id"))==true){m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+(d+1)+"</span></div>"+$(h.matches.choices[d]).text()+"</div>";
}else{m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+(d+1)+"</span></div>"+$(h.matches.choices[d]).text()+"</div>";
}}m+="</div>";}}else{if($(f).find("matching").attr("format")=="number-small"){for(var e=0;e<$(h.matches).size();e++){var m='<div id="matching-'+e+'" class="matching-column"><p id="matchingInstructions">'+h.matchingInstructions+"</p>";
for(var d=0;d<$(h.matches.choices).size();d++){if(Boolean($(h.matches.choices[d]).attr("id"))==true){m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+(d+1)+"</span></div>"+$(h.matches.choices[d]).text()+"</div>";
}else{m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient"><span>'+(d+1)+"</span></div>"+$(h.matches.choices[d]).text()+"</div>";
}}m+="</div>";}}else{for(var e=0;e<$(h.matches).size();e++){var m='<div id="matching-'+e+'" class="matching-column"><p id="matchingInstructions">'+h.matchingInstructions+"</p>";
for(var d=0;d<$(h.matches.choices).size();d++){if(Boolean($(h.matches.choices[d]).attr("id"))==true){m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient" style="'+$(f).find("matches").attr("children-styles")+'"><span>'+$(h.matches.choices[d]).text()+"</span></div></div>";
}else{m+='<div class="draggable-container gradient"><div data-id="'+$(h.matches.choices[d]).attr("id")+'" data-col="'+e+'" id="matching-'+e+"-draggable-"+d+'" class="matching-draggable gradient" style="'+$(f).find("matches").attr("children-styles")+'"><span>'+$(h.matches.choices[d]).text()+"</span></div></div>";
}}m+="</div>";}}}}}}}}if($(f).find("matching").attr("type")=="dynamic"){m+='<div id="drop-'+e+'" class="drop-column dynamic" style="'+$(f).find("drops").attr("style")+'">';
for(var d=0;d<$(h.drops.choices).size();d++){var a=$(f).find("drops").find("drop").eq(d);if(Boolean($(h.drops.choices[d]).attr("id"))==true){m+='<div class="droppable-container gradient" style="top:'+a.attr("y")+"px;left:"+a.attr("x")+"px;"+$(f).find("drops").attr("children-styles")+'"><div data-correct="'+$(h.drops.choices[d]).attr("correct")+'" data-col="'+e+'" id="matching-'+e+"-droppable-"+d+'" class="matching-droppable gradient"><div class="dropSpacer"></div>'+$(h.drops.choices[d]).text()+"</div></div>";
}else{m+='<div class="droppable-container gradient" style="top:'+a.attr("y")+"px;left:"+a.attr("x")+"px;"+$(f).find("drops").attr("children-styles")+'"><div data-correct="'+$(h.drops.choices[d]).attr("correct")+'" data-col="'+e+'" id="matching-'+e+"-droppable-"+d+'" class="matching-droppable gradient"><div class="dropSpacer"></div>'+$(h.drops.choices[d]).text()+"</div></div>";
}}m+="</div>";}else{m+='<div id="drop-'+e+'" class="drop-column" style="'+$(f).find("drops").attr("style")+'">';for(var d=0;d<$(h.drops.choices).size();
d++){if(Boolean($(h.drops.choices[d]).attr("id"))==true){m+='<div class="droppable-container gradient" style="'+$(f).find("drops").attr("children-styles")+'"><div data-correct="'+$(h.drops.choices[d]).attr("correct")+'" data-col="'+e+'" id="matching-'+e+"-droppable-"+d+'" class="matching-droppable gradient"><div class="dropSpacer"></div><div class="dropContent">'+$(h.drops.choices[d]).text()+"</div></div></div>";
}else{m+='<div class="droppable-container gradient" style="'+$(f).find("drops").attr("children-styles")+'"><div data-correct="'+$(h.drops.choices[d]).attr("correct")+'" data-col="'+e+'" id="matching-'+e+"-droppable-"+d+'" class="matching-droppable gradient"><div class="dropSpacer"></div><div class="dropContent">'+$(h.drops.choices[d]).text()+"</div></div></div>";
}}m+="</div>";}$("div#matching").append(m);if($(f).find("matching").attr("type")=="dynamic"){$(".drop-column").css("background","#FFF url("+ONboard.assetRoot+$(f).find("matching").find("image").text()+") top center no-repeat");
}$("div.matching-draggable span").each(function(){$(this).css("margin-top",-($(this).height()/2));});var g=$(".matching-droppable").size();$("div#activity a#submit").unbind("click").css("opacity","0.5");
$(".matching-draggable").draggable({containment:"#main",revert:"invalid"});$(".matching-droppable").droppable({drop:function(p,j){var s=$("#"+j.draggable[0].id);
var q=s.data("id");var o=$(this).parent().index();if(q==$(this).data("correct")){b.answers[o]=true;}else{b.answers[o]=false;}$("#"+j.draggable[0].id).position({of:$("#"+p.target.id),my:"left top",at:"left top"});
if(typeof $(this).data("dragged")=="undefined"){$(".matching-droppable").each(function(){if($(this).data("dragged")==q){$(this).data("dragged",null);delete b.dropped[$(this).parent().index()];
delete b.answers[$(this).parent().index()];}});$(this).data("dragged",q);b.dropped[o]=j.draggable[0].id;}else{$("#"+b.dropped[o]).animate({top:0,left:0});
$(".matching-droppable").each(function(){if($(this).data("dragged")==q){$(this).data("dragged",null);delete b.dropped[$(this).parent().index()];delete b.answers[$(this).parent().index()];
}});$(this).data("dragged",q);b.dropped[o]=j.draggable[0].id;}var r=0;for(var n=0;n<b.answers.length;n++){if(b.answers[n]==true||b.answers[n]==false){r++;
}}if(r==g){$("div#activity a#submit").one("click",function(){b.checkAnswers();}).css("opacity","1");}}});},checkAnswers:function(){var g=this;var d=this.content;
var a=true;if(g.answers==""){a=false;}var e=0;for(var b=0;b<g.answers.length;b++){if(g.answers[b]==false){a=false;g.answers[b]=undefined;$("#"+g.dropped[b]).animate({top:0,left:0});
$("div#activity a#submit").unbind("click").css("opacity","0.5");var f=$("#"+g.dropped[b]).data("id");$(".matching-droppable").each(function(){var h=$(this).data("dragged");
if(h==f){$(this).droppable("enable").data("dragged",null);delete g.dropped[$(this).parent().index()];}});}else{if(g.answers[b]==true){e++;}}}if(g.currentAttempt==g.maxAttempts&&a==false){settings.attempts.push(g.currentAttempt);
settings.points.push(0);cj.loadScreen();}else{if(g.currentAttempt==g.maxAttempts&&a==true){if(e==$(d.drops.choices).size()){$("a#submit").addClass("correct");
if($(this.data).find("feedbackAudio").text()!==""){var c=ONboard.assetRoot+$(this.data).find("feedbackAudio").text()+".mp4";ONboard.video.src({type:"video/mp4",src:c}).play();
}}}else{if(a==false){}else{if(a==true){if(e==$(d.drops.choices).size()){$("a#submit").addClass("correct");if($(this.data).find("feedbackAudio").text()!==""){var c=ONboard.assetRoot+$(this.data).find("feedbackAudio").text()+".mp4";
ONboard.video.src({type:"video/mp4",src:c}).play();}}}}}}},bindHotSpots:function(){var a=$("div#activity a.hotspot, div#activity a.hotspot-dynamic");a.on("click",function(){ONboard.modules.activity_drag_drop.loadHotSpot(this);
});$("a#hotspot-close").on("click",function(){ONboard.modules.activity_drag_drop.closeHotSpot();});},closeHotSpot:function(){var a=$("div#hotspot-popup");
a.fadeOut();},loadHotSpot:function(a){var c=$(a).data("id");var b=$("div#hotspot-popup");b.fadeIn().position({my:"center center",at:"center center",of:a}).find("div#hotspot-content").html(this.hotspots[c]);
},mediaEnded:function(){$("div#video div.vjs-control").hide();$("div#controls a#next").addClass("active");}};